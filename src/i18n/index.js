import * as Localization from 'expo-localization';
import { I18n } from 'i18n-js';
import React, { createContext, useContext, useMemo, useState } from 'react';

// Translations: English (en) and Albanian (sq)
const translations = {
  en: {
    posts: 'Posts',
    ranking: 'Ranking',
    polls: 'Polls',
    polls_subtitle: 'Vote and share your opinion',
    loading_polls: 'Loading polls...',
    failed_to_load_polls: 'Failed to load polls',
    vote_submitted: 'Vote submitted successfully',
    vote_removed: 'Vote removed successfully',
    vote_submit_failed: 'Failed to submit vote',
    vote_remove_failed: 'Failed to remove vote',
    auth_required: 'You must be signed in to vote',
    activities: 'Events',
    // Map Screen
    map: 'Map',
    map_explorer: 'Map Explorer',
    search_locations: 'Search locations',
    locations: 'Locations',
    sort_by: 'Sort by',
    no_results: 'No results',
    loading_map: 'Loading map...',
    failed_to_load_map: 'Failed to load map',
    map_loading_error: 'Map could not be loaded',
    please_try_again_later: 'Please try again later',
    open: 'Open',
    unknown_location: 'Unknown location',
    km_away: '{{count}} km away',
    kosovo: 'Kosovo',
    albania: 'Albania',
    macedonia: 'Macedonia',
    // Events Screen
    upcoming_events: 'Upcoming Events',
    recent: 'Recent',
    oldest: 'Oldest',
    alphabet: 'Alphabetical',
    events_load_error: 'Failed to load events.',
    no_events: 'No upcoming events.',
    filter_events: 'Filter events',
    interested: 'Interested',
    not_interested: 'Not interested',
    mark_interested: 'Mark as interested',
    remove_interested: 'Remove from interested',
    event_location: 'Location',
    event_date: 'Date',
    loading_events: 'Loading events...',
    sort_by: 'Sort by',
    view_details: 'View Details',
    save_event: 'Save Event',
    unsave_event: 'Unsave Event',
    about: 'About us',
    new_post: 'New Post',
    notifications: 'Notifications',
    clear_all: 'Clear all',
    no_notifications: 'No notifications',
    search: 'Search',
    profile: 'Profile',
    points_menu: 'My Points',
    activity_logs_menu: 'Activity Logs',
    my_posts_menu: 'My Posts',
    favorite_posts_menu: 'Favorite Posts',
    my_polls_menu: 'My Polls',
    update_password_menu: 'Update password',
    logout: 'Log out',
    home_title: 'Berllog',
    // Ranking Screen
    '24h': 'Today',
    last_week: 'Week',
    last_30_days: 'Month',
    all_time: 'All Time',
    no_rankings: 'No rankings available',
    failed_to_load: 'Failed to load rankings',
    retry: 'Retry',
    points: 'Points',
    point: 'Point',
    posts_count: 'Posts',
    post_count: 'Post',
    user: 'User',
    rank: 'Rank',
    perdrouesi: 'User',
    anonymous: 'Anonymous',
    // User Details Screen
    user_profile: 'User Profile',
    email: 'Email',
    date_of_birth: 'Date of Birth',
    address: 'Address',
    joined: 'Joined',
    recent_submissions: 'Recent Submissions',
    no_posts_yet: 'No posts yet',
    failed_to_load_profile: 'Failed to load profile',
    before: 'Before',
    after: 'After',
    untitled_post: 'Untitled Post',
    // Forgot Password Screen
    forgot_password: 'Forgot Password',
    forgot_password_description: 'Enter your email address and we will send you a link to reset your password.',
    email: 'Email Address',
    send_reset_link: 'Send Reset Link',
    reset_link_sent: 'Password reset link has been sent to your email.',
    reset_link_sent_short: 'Link Sent',
    reset_link_error: 'Could not send reset link. Please try again later.',
    back_to_login: 'Back to Login',
    loading: 'Loading...',
    anonymous: 'Anonymous',
    before: 'Before',
    after: 'After',
    upvote: 'Upvote',
    downvote: 'Downvote',
    comment: 'Comment',
    comments: 'Comments',
    favorite: 'Favorite',
    share: 'Share',
    time_minute: '{{count}} minute',
    time_minutes: '{{count}} minutes',
    time_hour: '{{count}} hour',
    time_hours: '{{count}} hours',
    time_day: '{{count}} day',
    time_days: '{{count}} days',
    no_posts_found: 'No posts found',
    light_mode: 'Light Mode',
    dark_mode: 'Dark Mode',
    statistics: 'Statistics',
    // Statistics Screen
    statistics_page_title: 'Statistics Dashboard',
    statistics_page_subtitle: 'Key metrics and insights at a glance',
    statistics_page_users: 'Total Users',
    statistics_page_posts: 'Total Posts',
    statistics_page_countries: 'Countries',
    statistics_page_cities: 'Cities',
    statistics_page_newest_member: 'Newest Member',
    statistics_page_joined: 'Joined',
    statistics_page_load_failed: 'Failed to load statistics',
    statistics_page_aria_key_stats: 'Key Statistics',
    statistics_page_aria_latest_user: 'Latest User Information',
    dark_mode: 'Dark Mode',
    post_details: 'Post Details',
    go_back: 'Go Back',
    post_not_found: 'Post not found',
    write_comment: 'Write a comment...',
    no_comments: 'No comments yet',
    check_out_post: 'Check out this post',
    interesting_post: 'Interesting post',
    location_unavailable: 'Location unavailable',
    status: 'Status',
    forgot_password_description: 'Enter your email address and we will send you a link to reset your password.',
    please_enter_valid_email: 'Please enter a valid email address',
    error: 'Error',
    success: 'Success',
    ok: 'OK',
    forgot_password_link: 'Forgot Password?',
    reset_link_sent: 'Password reset link has been sent to your email.',
    reset_link_sent_short: 'Link Sent',
    reset_link_error: 'Could not send reset link. Please try again later.',
    check_your_email: 'Check your email for the reset link',
    reset_helper_text: 'If an account exists with this email, you will receive a password reset link.',
    // Reaction Types Screen
    reactions_page: {
      title: 'Reaction Types',
      subtitle: 'View all available reaction types',
      loading: 'Loading reaction types...',
      load_failed: 'Failed to load reaction types',
      no_items: 'No reaction types found',
      children_count: '{{count}} subtypes',
      filter: {
        all: 'All',
        positive: 'Positive',
        negative: 'Negative'
      },
      aria: {
        filters: 'Reaction type filters',
        list: 'Reaction types list'
      }
    },
    reaction_type: {
      upvote: 'Upvote',
      downvote: 'Downvote',
      positive: 'Positive',
      negative: 'Negative'
    },
    
    statistics_page:{
      title:"Statistics Dashboard",
      subtitle:"Key metrics and insights at a glance",
      users:"Total Users",
      posts:"Total Posts",
      countries:"Countries",
      cities:"Cities",
      newest_member:"Newest Member",
      joined:"Joined",
      load_failed:"Failed to load statistics",
      loading:"Loading statistics...",
      key_metrics:"Key Metrics",
      recent_activity:"Recent Activity",
      last_week:"Last Week",
      last_month:"Last Month",
      aria:{
        key_stats:"Key Statistics",
        latest_user:"Latest User Information"
      }
    },
    
    // About Screen Translations
    why_berllog_title: 'Why Berllog?',
    why_berllog_content: 'Berllog is a community-driven platform dedicated to environmental awareness and action. We connect people who care about our planet and want to make a difference through local cleanup initiatives, recycling education, and sustainable practices.',
    every_contribution: 'Every contribution matters!',
    
    download_app_title: 'Download Our App',
    download_app_content: 'Get the Berllog app on your mobile device to track cleanups, connect with local environmental groups, and contribute to a cleaner planet wherever you are.',
    
    circle_users: 'Active Users',
    circle_countries: 'Countries',
    circle_cities: 'Cities',
    circle_cleanups: 'Cleanups',
    
    center_title: 'Recycling Center',
    center_content: 'Find recycling centers near you and learn how to properly sort and dispose of different materials. Our interactive map helps you locate the nearest recycling facilities and provides information on what materials they accept.',
    direction:"Direction",
    
  },
  sq: {
    posts: 'Postimet',
    ranking: 'Renditja',
    polls: 'Sondazhet',
    polls_subtitle: 'Voto dhe ndaj mendimin tënd',
    loading_polls: 'Duke ngarkuar sondazhet...',
    failed_to_load_polls: 'Dështoi në ngarkimin e sondazheve',
    vote_submitted: 'Vota u dërgua me sukses',
    vote_removed: 'Vota u hoq me sukses',
    vote_submit_failed: 'Dështoi në dërgimin e votës',
    vote_remove_failed: 'Dështoi në heqjen e votës',
    auth_required: 'Duhet të jeni të kyçur për të votuar',
    events: 'Ngjarjet',
    activities: 'Ngjarjet',
    // Map Screen
    map: 'Harta',
    map_explorer: 'Eksplorues i Hartës',
    search_locations: 'Kërko vendndodhje',
    locations: 'Lokacionet',
    sort_by: 'Rendit sipas',
    no_results: 'Nuk ka rezultate',
    loading_map: 'Duke ngarkuar hartën...',
    failed_to_load_map: 'Dështoi në ngarkimin e hartës',
    map_loading_error: 'Harta nuk mund të ngarkohej',
    please_try_again_later: 'Ju lutem provoni përsëri më vonë',
    open: 'Hap',
    unknown_location: 'Vendndodhje e panjohur',
    km_away: '{{count}} km larg',
    kosovo: 'Kosovë',
    albania: 'Shqipëri',
    macedonia: 'Maqedoni',
    go_back: 'Kthehu',
    // Events Screen
    upcoming_events: 'Ngjarjet e Ardhshme',
    recent: 'Të fundit',
    oldest: 'Më të vjetrat',
    alphabet: 'Alfabetike',
    events_load_error: 'Dështoi në ngarkimin e ngjarjeve.',
    no_events: 'Nuk ka ngjarje të ardhshme.',
    filter_events: 'Filtro ngjarjet',
    
    // Reaction Types Screen
    reactions_page: {
      title: 'Llojet e Reagimeve',
      subtitle: 'Shiko të gjitha llojet e reagimeve të disponueshme',
      loading: 'Duke ngarkuar llojet e reagimeve...',
      load_failed: 'Dështoi në ngarkimin e llojeve të reagimeve',
      no_items: 'Nuk u gjetën lloje reagimesh',
      children_count: '{{count}} nënlloje',
      filter: {
        all: 'Të gjitha',
        positive: 'Pozitive',
        negative: 'Negative'
      },
      aria: {
        filters: 'Filtrat e llojeve të reagimeve',
        list: 'Lista e llojeve të reagimeve'
      }
    },
    reaction_type: {
      upvote: 'Votë pozitive',
      downvote: 'Votë negative',
      positive: 'Pozitive',
      negative: 'Negative'
    },
    interested: 'I interesuar',
    not_interested: 'Jo i interesuar',
    mark_interested: 'Shëno si i interesuar',
    remove_interested: 'Hiq nga të interesuarat',
    event_location: 'Vendndodhja',
    event_date: 'Data',
    loading_events: 'Duke ngarkuar ngjarjet...',
    sort_by: 'Rendit sipas',
    view_details: 'Shiko Detajet',
    save_event: 'Ruaj Ngjarjen',
    unsave_event: 'Hiq Ngjarjen',
    about: 'Rreth Nesh',
    login: 'Kyçu',
    register: 'Regjistrohu',
    logout: 'Dilni',
    email: 'Email',
    password: 'Fjalëkalimi',
    forgot_password: 'Keni harruar fjalëkalimin?',
    dont_have_account: 'Nuk keni një llogari?',
    already_have_account: 'Tashmë keni një llogari?',
    name: 'Emri',
    confirm_password: 'Konfirmo Fjalëkalimin',
    reset_password: 'Rivendos Fjalëkalimin',
    send_reset_link: 'Dërgo Lidhjen e Rivendosjes',
    back_to_login: 'Kthehu te Kyçja',
    error: 'Gabim',
    success: 'Sukses',
    ok: 'OK',
    forgot_password_link: 'Keni harruar fjalëkalimin?',
    back_to_login: 'Kthehu tek kyçja',
    // Ranking Screen
    '24h': 'Sot',
    last_week: 'Java',
    last_30_days: 'Muaji',
    all_time: 'Gjithmonë',
    no_rankings: 'Nuk ka renditje në dispozicion',
    failed_to_load: 'Dështoi në ngarkimin e renditjes',
    retry: 'Provo përsëri',
    points: 'Pikë',
    point: 'Pikë',
    posts_count: 'Postime',
    post_count: 'Postim',
    user: 'Përdoruesi',
    rank: 'Renditja',
    perdrouesi: 'Përdoruesi',
    anonymous: 'Anonim',
    // User Details Screen
    user_profile: 'Profili i Përdoruesit',
    email: 'Email',
    date_of_birth: 'Data e lindjes',
    address: 'Adresa',
    joined: 'Anëtarësuar',
    recent_submissions: 'Postimet e fundit',
    no_posts_yet: 'Nuk ka postime ende',
    failed_to_load_profile: 'Dështoi në ngarkimin e profilit',
    before: 'Para',
    after: 'Pas',
    untitled_post: 'Postim pa titull',
    // HomeScreen
    loading: 'Duke u ngarkuar...',
    categories: 'Kategoritë',
    technology: 'Teknologji',
    sports: 'Sport',
    politics: 'Politikë',
    entertainment: 'Argëtim',
    science: 'Shkencë',
    latest_posts: 'Postimet e fundit',
    see_all: 'Shiko të gjitha',
    latest_poll: 'Anketa e fundit',
    no_polls: 'Nuk ka anketa në dispozicion',
    votes: 'vota',
    total_votes: 'vota totale',
    before: 'Para',
    after: 'Pas',
    anonymous: 'Anonim',
    time_minute: '{{count}} minutë',
    time_minutes: '{{count}} minuta',
    time_hour: '{{count}} orë',
    time_hours: '{{count}} orë',
    time_day: '{{count}} ditë',
    time_days: '{{count}} ditë',
    no_posts_found: 'Nuk u gjetën postime',
    light_mode: 'Modaliteti i Dritës',
    dark_mode: 'Modaliteti i Errët',
    statistics: 'Statistikat',
    // Statistics Screen
    statistics_page_title: 'Paneli i Statistikave',
    statistics_page_subtitle: 'Metrika dhe të dhëna në një vështrim',
    statistics_page_users: 'Përdorues Gjithsej',
    statistics_page_posts: 'Postime Gjithsej',
    statistics_page_countries: 'Vende',
    statistics_page_cities: 'Qytete',
    statistics_page_newest_member: 'Anëtari i Ri',
    statistics_page_joined: 'U anëtarësua',
    statistics_page_load_failed: 'Dështoi të ngarkojë statistikat',
    statistics_page_aria_key_stats: 'Statistika Kryesore',
    statistics_page_aria_latest_user: 'Informacioni më i ri i përdoruesit',
    statistics_page: {
      title: 'Paneli i Statistikave',
      subtitle: 'Metrika dhe të dhëna në një vështrim',
      users: 'Përdorues Gjithsej',
      posts: 'Postime Gjithsej',
      countries: 'Vende',
      cities: 'Qytete',
      newest_member: 'Anëtari i Ri',
      joined: 'U anëtarësua',
      load_failed: 'Dështoi të ngarkojë statistikat',
      loading: 'Duke ngarkuar statistikat...',
      key_metrics: 'Metrika Kryesore',
      recent_activity: 'Aktiviteti i Fundit',
      last_week: 'Java e Fundit',
      last_month: 'Muaji i Fundit',
      aria: {
        key_stats: 'Statistika Kryesore',
        latest_user: 'Informacioni më i ri i përdoruesit'
      }
    },
    
    // About Screen Translations
    why_berllog_title: 'Pse Berllog?',
    why_berllog_content: 'Berllog është një platformë e drejtuar nga komuniteti e dedikuar për ndërgjegjësimin dhe veprimin mjedisor. Ne lidhim njerëzit që kujdesen për planetin tonë dhe duan të bëjnë ndryshime përmes iniciativave lokale të pastrimit, edukimit për riciklimin dhe praktikave të qëndrueshme.',
    every_contribution: 'Çdo kontribut ka rëndësi!',
    
    download_app_title: 'Shkarko Aplikacionin Tonë',
    download_app_content: 'Merrni aplikacionin Berllog në pajisjen tuaj celulare për të ndjekur pastrimet, për t\'u lidhur me grupe lokale mjedisore dhe për të kontribuar në një planet më të pastër kudo që jeni.',
    
    circle_users: 'Përdorues Aktivë',
    circle_countries: 'Vende',
    circle_cities: 'Qytete',
    circle_cleanups: 'Pastrime',
    
    center_title: 'Qendra e Riciklimit',
    center_content: 'Gjeni qendra riciklimi pranë jush dhe mësoni si të ndani dhe hidhni siç duhet materiale të ndryshme. Harta jonë interaktive ju ndihmon të lokalizoni objektet më të afërta të riciklimit dhe ofron informacion mbi materialet që ata pranojnë.',
    dark_mode: 'Mode e Errët',
    direction:"udhëzime",
    
  },
};

const i18n = new I18n(translations);

i18n.enableFallback = true;

const deviceLocale = Localization.getLocales?.()[0]?.languageCode || 'en';
i18n.locale = ['en', 'sq'].includes(deviceLocale) ? deviceLocale : 'en';

const I18nContext = createContext({
  locale: i18n.locale,
  setLocale: (l) => {},
  t: (k, opts) => i18n.t(k, opts),
});

export const I18nProvider = ({ children }) => {
  const [locale, setLocale] = useState(i18n.locale);

  const value = useMemo(() => ({
    locale,
    setLocale: (l) => {
      i18n.locale = l;
      setLocale(l);
    },
    t: (k, opts) => i18n.t(k, opts),
  }), [locale]);

  return (
    <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
  );
};

export const useI18n = () => useContext(I18nContext);
